<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>
  Module: CsvTemplateGenerator
  
    &mdash; Documentation by YARD 0.9.28
  
</title>

  <link rel="stylesheet" href="css/style.css" type="text/css" />

  <link rel="stylesheet" href="css/common.css" type="text/css" />

<script type="text/javascript">
  pathId = "CsvTemplateGenerator";
  relpath = '';
</script>


  <script type="text/javascript" charset="utf-8" src="js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="js/app.js"></script>


  </head>
  <body>
    <div class="nav_wrap">
      <iframe id="nav" src="class_list.html?1"></iframe>
      <div id="resizer"></div>
    </div>

    <div id="main" tabindex="-1">
      <div id="header">
        <div id="menu">
  
    <a href="_index.html">Index (C)</a> &raquo;
    
    
    <span class="title">CsvTemplateGenerator</span>
  
</div>

        <div id="search">
  
    <a class="full_list_link" id="class_list_link"
        href="class_list.html">

        <svg width="24" height="24">
          <rect x="0" y="4" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="12" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="20" width="24" height="4" rx="1" ry="1"></rect>
        </svg>
    </a>
  
</div>
        <div class="clear"></div>
      </div>

      <div id="content"><h1>Module: CsvTemplateGenerator
  
  
  
</h1>
<div class="box_info">
  

  
  
  
  
  

  

  
  <dl>
    <dt>Defined in:</dt>
    <dd>backend/app/lib/csv_template_generator.rb</dd>
  </dl>
  
</div>

<h2>Defined Under Namespace</h2>
<p class="children">
  
    
  
    
      <strong class="classes">Classes:</strong> <span class='object_link'><a href="CsvTemplateGenerator/CsvTemplateError.html" title="CsvTemplateGenerator::CsvTemplateError (class)">CsvTemplateError</a></span>, <span class='object_link'><a href="CsvTemplateGenerator/Template.html" title="CsvTemplateGenerator::Template (class)">Template</a></span>, <span class='object_link'><a href="CsvTemplateGenerator/TemplateSpec.html" title="CsvTemplateGenerator::TemplateSpec (class)">TemplateSpec</a></span>
    
  
    
  
</p>







  
    <h2>
      Class Method Summary
      <small><a href="#" class="summary_toggle">collapse</a></small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#csv_for_top_container_generation-class_method" title="csv_for_top_container_generation (class method)">.<strong>csv_for_top_container_generation</strong>(resource_id)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Module-level methods here are primarily what’s called by consumers at the controller level.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#q-class_method" title="q (class method)">.<strong>q</strong>(*args)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
</div></span>
  
</li>

      
    </ul>
  



  <div id="class_method_details" class="method_details_list">
    <h2>Class Method Details</h2>

    
      <div class="method_details first">
  <h3 class="signature first" id="csv_for_top_container_generation-class_method">
  
    .<strong>csv_for_top_container_generation</strong>(resource_id)  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>Module-level methods here are primarily what’s called by consumers
at the controller level.  Generally they will consist of
  1. instantiate a template definition
  2. fetch a a dataset
  3. return an enumerator over CSV lines for streaming to frontend/direct download</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'backend/app/lib/csv_template_generator.rb', line 174</span>

<span class='rubyid_def def kw'>def</span> <span class='rubyid_csv_for_top_container_generation identifier id'>csv_for_top_container_generation</span><span class='lparen token'>(</span><span class='rubyid_resource_id identifier id'>resource_id</span><span class='rparen token'>)</span>
  <span class='rubyid_tmpl identifier id'>tmpl</span> <span class='assign token'>=</span> <span class='rubyid_Template constant id'>Template</span><span class='dot token'>.</span><span class='rubyid_new identifier id'>new</span><span class='lparen token'>(</span>
    <span class='rubyid_TemplateSpec constant id'>TemplateSpec</span><span class='dot token'>.</span><span class='rubyid_new identifier id'>new</span><span class='lparen token'>(</span>
      <span class='label val'>sheet_description:</span> <span class='string val'>&quot;Archival Object Top Container Generation Template&quot;</span><span class='comma token'>,</span>
      <span class='label val'>field_name_text:</span> <span class='string val'>&quot;ArchivesSpace field code (please don&#39;t edit this row)&quot;</span><span class='comma token'>,</span>
      <span class='label val'>title_text:</span> <span class='string val'>&quot;Field Name&quot;</span><span class='comma token'>,</span>
      <span class='label val'>group_text:</span> <span class='string val'>&quot;Maps to ASpace Type&quot;</span><span class='comma token'>,</span>
      <span class='label val'>columns:</span> <span class='lbrace token'>{</span>
        <span class='comment val'># For reference</span>
        <span class='label val'>archival_object_id:</span> <span class='lbrace token'>{</span><span class='label val'>title:</span> <span class='string val'>&quot;Archival Object ID&quot;</span><span class='comma token'>,</span> <span class='label val'>group:</span> <span class='string val'>&quot;Archival Object&quot;</span><span class='rbrace token'>}</span><span class='comma token'>,</span>
        <span class='label val'>ref_id:</span> <span class='lbrace token'>{</span><span class='label val'>title:</span> <span class='string val'>&quot;Ref ID&quot;</span><span class='comma token'>,</span> <span class='label val'>group:</span> <span class='string val'>&quot;Archival Object&quot;</span><span class='rbrace token'>}</span><span class='comma token'>,</span>
        <span class='label val'>component_id:</span> <span class='lbrace token'>{</span><span class='label val'>title:</span> <span class='string val'>&quot;Component ID&quot;</span><span class='comma token'>,</span> <span class='label val'>group:</span> <span class='string val'>&quot;Archival Object&quot;</span><span class='rbrace token'>}</span><span class='comma token'>,</span>
        <span class='label val'>archival_object_title:</span> <span class='lbrace token'>{</span><span class='label val'>title:</span> <span class='string val'>&quot;Title&quot;</span><span class='comma token'>,</span> <span class='label val'>group:</span> <span class='string val'>&quot;Archival Object&quot;</span><span class='rbrace token'>}</span><span class='comma token'>,</span>
        <span class='label val'>resource_title:</span> <span class='lbrace token'>{</span><span class='label val'>title:</span> <span class='string val'>&quot;Resource Title&quot;</span><span class='comma token'>,</span> <span class='label val'>group:</span> <span class='string val'>&quot;Resource&quot;</span><span class='rbrace token'>}</span><span class='comma token'>,</span>
        <span class='label val'>ead_id:</span> <span class='lbrace token'>{</span><span class='label val'>title:</span> <span class='string val'>&quot;EAD ID&quot;</span><span class='comma token'>,</span> <span class='label val'>group:</span> <span class='string val'>&quot;Resource&quot;</span><span class='rbrace token'>}</span><span class='comma token'>,</span>
        <span class='label val'>identifier:</span> <span class='lbrace token'>{</span><span class='label val'>title:</span> <span class='string val'>&quot;Identifier&quot;</span><span class='comma token'>,</span> <span class='label val'>group:</span> <span class='string val'>&quot;Resource&quot;</span><span class='comma token'>,</span> <span class='label val'>formatter:</span> <span class='minus op'>-</span><span class='gt op'>&gt;</span><span class='lparen token'>(</span><span class='rubyid_value identifier id'>value</span><span class='rparen token'>)</span> <span class='lbrace token'>{</span> <span class='rubyid_JSON constant id'>JSON</span><span class='dot token'>.</span><span class='rubyid_parse identifier id'>parse</span><span class='lparen token'>(</span><span class='rubyid_value identifier id'>value</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='rubyid_compact identifier id'>compact</span><span class='dot token'>.</span><span class='rubyid_join identifier id'>join</span><span class='lparen token'>(</span><span class='string val'>&quot; &quot;</span><span class='rparen token'>)</span> <span class='rbrace token'>}</span><span class='rbrace token'>}</span><span class='comma token'>,</span>
        <span class='comment val'># Editable</span>
        <span class='label val'>instance_type:</span> <span class='lbrace token'>{</span><span class='label val'>title:</span> <span class='string val'>&quot;Instance Type&quot;</span><span class='comma token'>,</span> <span class='label val'>group:</span> <span class='string val'>&quot;Instance&quot;</span><span class='comma token'>,</span> <span class='label val'>blank:</span> <span class='rubyid_true true kw'>true</span><span class='rbrace token'>}</span><span class='comma token'>,</span>
        <span class='label val'>top_container_id:</span> <span class='lbrace token'>{</span><span class='label val'>title:</span> <span class='string val'>&quot;Top Container ID (existing top container, leave blank if creating new container)&quot;</span><span class='comma token'>,</span> <span class='label val'>group:</span> <span class='string val'>&quot;Container&quot;</span><span class='comma token'>,</span> <span class='label val'>blank:</span> <span class='rubyid_true true kw'>true</span><span class='rbrace token'>}</span><span class='comma token'>,</span>
        <span class='label val'>top_container_type:</span> <span class='lbrace token'>{</span><span class='label val'>title:</span> <span class='string val'>&quot;Top Container Type&quot;</span><span class='comma token'>,</span> <span class='label val'>blank:</span> <span class='rubyid_true true kw'>true</span><span class='comma token'>,</span> <span class='label val'>group:</span> <span class='string val'>&quot;Top Container&quot;</span><span class='rbrace token'>}</span><span class='comma token'>,</span>
        <span class='label val'>top_container_indicator:</span> <span class='lbrace token'>{</span><span class='label val'>title:</span> <span class='string val'>&quot;Top Container Indicator&quot;</span><span class='comma token'>,</span> <span class='label val'>group:</span> <span class='string val'>&quot;Top Container&quot;</span><span class='comma token'>,</span> <span class='label val'>blank:</span> <span class='rubyid_true true kw'>true</span><span class='rbrace token'>}</span><span class='comma token'>,</span>
        <span class='label val'>top_container_barcode:</span> <span class='lbrace token'>{</span><span class='label val'>title:</span> <span class='string val'>&quot;Top container barcode&quot;</span><span class='comma token'>,</span> <span class='label val'>group:</span> <span class='string val'>&quot;Top Container&quot;</span><span class='comma token'>,</span> <span class='label val'>blank:</span> <span class='rubyid_true true kw'>true</span><span class='rbrace token'>}</span><span class='comma token'>,</span>
        <span class='label val'>container_profile_id:</span> <span class='lbrace token'>{</span><span class='label val'>title:</span> <span class='string val'>&quot;Container Profile ID&quot;</span><span class='comma token'>,</span> <span class='label val'>group:</span> <span class='string val'>&quot;Top Container&quot;</span><span class='comma token'>,</span> <span class='label val'>blank:</span> <span class='rubyid_true true kw'>true</span><span class='rbrace token'>}</span><span class='comma token'>,</span>
        <span class='label val'>child_type:</span> <span class='lbrace token'>{</span><span class='label val'>title:</span> <span class='string val'>&quot;Child Type&quot;</span><span class='comma token'>,</span> <span class='label val'>group:</span> <span class='string val'>&quot;Sub Container&quot;</span><span class='comma token'>,</span> <span class='label val'>blank:</span> <span class='rubyid_true true kw'>true</span><span class='rbrace token'>}</span><span class='comma token'>,</span>
        <span class='label val'>child_indicator:</span> <span class='lbrace token'>{</span><span class='label val'>title:</span> <span class='string val'>&quot;Child Indicator&quot;</span><span class='comma token'>,</span> <span class='label val'>group:</span> <span class='string val'>&quot;Sub Container&quot;</span><span class='comma token'>,</span> <span class='label val'>blank:</span> <span class='rubyid_true true kw'>true</span><span class='rbrace token'>}</span><span class='comma token'>,</span>
        <span class='label val'>child_barcode:</span> <span class='lbrace token'>{</span><span class='label val'>title:</span> <span class='string val'>&quot;Child Barcode&quot;</span><span class='comma token'>,</span> <span class='label val'>group:</span> <span class='string val'>&quot;Sub Container&quot;</span><span class='comma token'>,</span> <span class='label val'>blank:</span> <span class='rubyid_true true kw'>true</span><span class='rbrace token'>}</span><span class='comma token'>,</span>
        <span class='label val'>location_id:</span> <span class='lbrace token'>{</span><span class='label val'>title:</span> <span class='string val'>&quot;Location ID&quot;</span><span class='comma token'>,</span> <span class='label val'>group:</span> <span class='string val'>&quot;Location&quot;</span><span class='comma token'>,</span> <span class='label val'>blank:</span> <span class='rubyid_true true kw'>true</span><span class='rbrace token'>}</span>
      <span class='rbrace token'>}</span>
    <span class='rparen token'>)</span>
  <span class='rparen token'>)</span>

  <span class='rubyid_dataset identifier id'>dataset</span> <span class='assign token'>=</span> <span class='rubyid_DB constant id'>DB</span><span class='dot token'>.</span><span class='rubyid_open identifier id'>open</span> <span class='rubyid_do do kw'>do</span> <span class='bitor op'>|</span><span class='rubyid_ds identifier id'>ds</span><span class='bitor op'>|</span>
    <span class='rubyid_ds identifier id'>ds</span><span class='lbrack token'>[</span><span class='symbol val'>:resource</span><span class='rbrack token'>]</span><span class='dot token'>.</span>
      <span class='rubyid_inner_join identifier id'>inner_join</span><span class='lparen token'>(</span><span class='symbol val'>:archival_object</span><span class='comma token'>,</span> <span class='symbol val'>:root_record_id</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='symbol val'>:id</span><span class='rparen token'>)</span><span class='dot token'>.</span>
      <span class='rubyid_where identifier id'>where</span><span class='lparen token'>(</span><span class='rubyid_q identifier id'>q</span><span class='lparen token'>(</span><span class='symbol val'>:resource</span><span class='comma token'>,</span> <span class='symbol val'>:id</span><span class='rparen token'>)</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='rubyid_resource_id identifier id'>resource_id</span><span class='rparen token'>)</span><span class='dot token'>.</span>
      <span class='rubyid_select identifier id'>select</span><span class='lparen token'>(</span>
        <span class='rubyid_q identifier id'>q</span><span class='lparen token'>(</span><span class='symbol val'>:archival_object</span><span class='comma token'>,</span> <span class='symbol val'>:id</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='rubyid_as identifier id'>as</span><span class='lparen token'>(</span><span class='symbol val'>:archival_object_id</span><span class='rparen token'>)</span><span class='comma token'>,</span>
        <span class='rubyid_q identifier id'>q</span><span class='lparen token'>(</span><span class='symbol val'>:archival_object</span><span class='comma token'>,</span> <span class='symbol val'>:ref_id</span><span class='rparen token'>)</span><span class='comma token'>,</span>
        <span class='rubyid_q identifier id'>q</span><span class='lparen token'>(</span><span class='symbol val'>:archival_object</span><span class='comma token'>,</span> <span class='symbol val'>:component_id</span><span class='rparen token'>)</span><span class='comma token'>,</span>
        <span class='rubyid_q identifier id'>q</span><span class='lparen token'>(</span><span class='symbol val'>:archival_object</span><span class='comma token'>,</span> <span class='symbol val'>:title</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='rubyid_as identifier id'>as</span><span class='lparen token'>(</span><span class='symbol val'>:archival_object_title</span><span class='rparen token'>)</span><span class='comma token'>,</span>
        <span class='rubyid_q identifier id'>q</span><span class='lparen token'>(</span><span class='symbol val'>:resource</span><span class='comma token'>,</span> <span class='symbol val'>:title</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='rubyid_as identifier id'>as</span><span class='lparen token'>(</span><span class='symbol val'>:resource_title</span><span class='rparen token'>)</span><span class='comma token'>,</span>
        <span class='rubyid_q identifier id'>q</span><span class='lparen token'>(</span><span class='symbol val'>:resource</span><span class='comma token'>,</span> <span class='symbol val'>:ead_id</span><span class='rparen token'>)</span><span class='comma token'>,</span>
        <span class='rubyid_q identifier id'>q</span><span class='lparen token'>(</span><span class='symbol val'>:resource</span><span class='comma token'>,</span> <span class='symbol val'>:identifier</span><span class='rparen token'>)</span>
      <span class='rparen token'>)</span><span class='dot token'>.</span>
      <span class='rubyid_order identifier id'>order</span><span class='lparen token'>(</span><span class='rubyid_q identifier id'>q</span><span class='lparen token'>(</span><span class='symbol val'>:archival_object</span><span class='comma token'>,</span> <span class='symbol val'>:id</span><span class='rparen token'>)</span><span class='rparen token'>)</span>
  <span class='rubyid_end end kw'>end</span>
  <span class='rubyid_tmpl identifier id'>tmpl</span><span class='dot token'>.</span><span class='rubyid_each identifier id'>each</span><span class='lparen token'>(</span><span class='rubyid_dataset identifier id'>dataset</span><span class='rparen token'>)</span>
<span class='rubyid_end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="q-class_method">
  
    .<strong>q</strong>(*args)  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


164
165
166
167</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'backend/app/lib/csv_template_generator.rb', line 164</span>

<span class='rubyid_def def kw'>def</span> <span class='rubyid_q identifier id'>q</span><span class='lparen token'>(</span><span class='mult op'>*</span><span class='rubyid_args identifier id'>args</span><span class='rparen token'>)</span>
  <span class='comment val'># Convenience method to get qualified names without having to type 14 chars</span>
  <span class='rubyid_Sequel constant id'>Sequel</span><span class='dot token'>.</span><span class='rubyid_qualify identifier id'>qualify</span><span class='lparen token'>(</span><span class='mult op'>*</span><span class='rubyid_args identifier id'>args</span><span class='rparen token'>)</span>
<span class='rubyid_end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

</div>

      <div id="footer">
  ArchivesSpace Version master Documentation Generated on Thu Sep  8 15:53:48 2022 by
  <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.9.28.
</div>

    </div>
  </body>
</html>